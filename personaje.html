<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Personajes de Rol</title>
    <style>
        /* Diseño básico */
        body {
            display: flex;
            font-family: Arial, sans-serif;
            margin: 0;
            height: 100vh;
        }
        .container {
            display: flex;
            width: 100%;
        }
        .left-panel, .right-panel {
            padding: 20px;
            box-sizing: border-box;
        }
        .left-panel {
            width: 50%;
            background-color: #f4f4f4;
            border-right: 2px solid #ccc;
        }
        .right-panel {
            width: 50%;
            background-color: #ffffff;
        }
        h2 {
            margin-top: 0;
        }
        .stat {
            margin-bottom: 10px;
        }
        .character-preview {
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
        .roll-select option.available {
            color: green;
        }
        .roll-select option.unavailable {
            color: red;
        }
        table.stats-table {
            width: 100%;
            border-collapse: collapse;
        }
        table.stats-table th, table.stats-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Panel izquierdo: Opciones -->
        <div class="left-panel">
            <h2>Opciones del Personaje</h2>
            <div class="stat">
                <label for="race">Raza:</label>
                <select id="race" onchange="loadBaseStats()">
                    <option value="Enano">Enano</option>
                    <option value="Elfo">Elfo</option>
                    <option value="Mediano">Mediano</option>
                    <option value="Humano">Humano</option>
                    <option value="Semiogro">Semiogro</option>
                    <option value="Pato">Pato</option>
                </select>
            </div>

            <div class="stat">
                <label><input type="checkbox" id="advantageOption" onchange="toggleAdvantage()"> Opción ventajosa</label>
            </div>

            <button onclick="generateRolls()">Generar Tiradas</button>

            <!-- Atributos Base en Tabla -->
            <h3>Estadísticas Base</h3>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>FUE</th>
                        <th>CON</th>
                        <th>DES</th>
                        <th>SAB</th>
                        <th>DET</th>
                        <th>VIT</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="base-values">
                        <td id="base-strength">-</td>
                        <td id="base-constitution">-</td>
                        <td id="base-dexterity">-</td>
                        <td id="base-wisdom">-</td>
                        <td id="base-determination">-</td>
                        <td id="base-vitality">-</td>
                    </tr>
                    <tr id="roll-selectors" style="display: none;">
                        <td><select id="select-strength" class="roll-select" onchange="updateAdjustedStats()"></select></td>
                        <td><select id="select-constitution" class="roll-select" onchange="updateAdjustedStats()"></select></td>
                        <td><select id="select-dexterity" class="roll-select" onchange="updateAdjustedStats()"></select></td>
                        <td><select id="select-wisdom" class="roll-select" onchange="updateAdjustedStats()"></select></td>
                        <td><select id="select-determination" class="roll-select" onchange="updateAdjustedStats()"></select></td>
                        <td>-</td>
                    </tr>
                    <tr id="roll-values" style="display: none;">
                        <td id="roll-strength">-</td>
                        <td id="roll-constitution">-</td>
                        <td id="roll-dexterity">-</td>
                        <td id="roll-wisdom">-</td>
                        <td id="roll-determination">-</td>
                        <td id="roll-vitality">-</td>
                    </tr>
                    <!-- Texto de Distribución de Puntos Adicionales -->
            <tr>
                <td colspan="6" id="remaining-points" style="text-align: center;"><strong>Distribuye 15 puntos adicionales</strong></td>
            </tr>
            <!-- Cuadros de Distribución de Puntos Adicionales -->
            <tr>
                <td>  <input type="number" id="extra-strength" value="0" min="0" max="10" onchange="updateExtraPoints()"> </td>
                <td>  <input type="number" id="extra-constitution" value="0" min="0" max="10" onchange="updateExtraPoints()"> </td>
                <td>  <input type="number" id="extra-dexterity" value="0" min="0" max="10" onchange="updateExtraPoints()"> </td>
                <td>  <input type="number" id="extra-wisdom" value="0" min="0" max="10" onchange="updateExtraPoints()"> </td>
                <td>  <input type="number" id="extra-determination" value="0" min="0" max="10" onchange="updateExtraPoints()"> </td>
            </tr>
                </tbody>
            </table>

            <!-- Estadísticas Ajustadas -->
            <h3>Estadísticas Ajustadas</h3>
            <p>Fuerza: <span id="final-strength">-</span></p>
            <p>Constitución: <span id="final-constitution">-</span></p>
            <p>Destreza: <span id="final-dexterity">-</span></p>
            <p>Sabiduría: <span id="final-wisdom">-</span></p>
            <p>Determinación: <span id="final-determination">-</span></p>
            <p>Vitalidad: <span id="final-vitality">-</span></p>
        </div>

        <!-- Panel derecho: Vista previa -->
        <div class="right-panel">
            <h2>Vista Previa del Personaje</h2>
            <div class="character-preview" id="character-preview">
                <p><strong>Raza:</strong> <span id="preview-race">-</span></p>
                <h3>Estadísticas Totales</h3>
                <p><strong>Fuerza:</strong> <span id="preview-strength">-</span></p>
                <p><strong>Constitución:</strong> <span id="preview-constitution">-</span></p>
                <p><strong>Destreza:</strong> <span id="preview-dexterity">-</span></p>
                <p><strong>Sabiduría:</strong> <span id="preview-wisdom">-</span></p>
                <p><strong>Determinación:</strong> <span id="preview-determination">-</span></p>
                <p><strong>Vitalidad:</strong> <span id="preview-vitality">-</span></p>
            </div>
        </div>
    </div>

    <script>
        const raceStats = {
            "Enano": { strength: 40, constitution: 30, dexterity: 25, wisdom: 25, determination: 30, vitality: "1d6+6" },
            "Elfo": { strength: 25, constitution: 20, dexterity: 40, wisdom: 35, determination: 30, vitality: "1d6+8" },
            "Mediano": { strength: 20, constitution: 20, dexterity: 40, wisdom: 30, determination: 40, vitality: "1d6+5" },
            "Humano": { strength: 30, constitution: 30, dexterity: 30, wisdom: 30, determination: 30, vitality: "1d6+7" },
            "Semiogro": { strength: 50, constitution: 40, dexterity: 25, wisdom: 15, determination: 40, vitality: "2d6+10" },
            "Pato": { strength: 25, constitution: 25, dexterity: 30, wisdom: 30, determination: 40, vitality: "1d6+6" }
        };

        let finalStats = {};
        let rolls = [];
        let remainingPoints = 15;

        function loadBaseStats() {
            const race = document.getElementById("race").value;
            const stats = raceStats[race];

            for (let [key, value] of Object.entries(stats)) {
                finalStats[key] = value;
                if (key === 'vitality') {
                    const vitalityRoll = rollDice(value);
                    document.getElementById("base-" + key).textContent = `VIT ${value}=${vitalityRoll}`;
                    finalStats[key] = vitalityRoll;
                } else {
                    document.getElementById("base-" + key).textContent = value;
                }
                document.getElementById("final-" + key).textContent = value;
            }

            calculateVitality(race);
            updatePreview();
        }

        function rollDice(dice) {
            const [num, sides, bonus] = dice.match(/\d+/g).map(Number);
            let sum = bonus || 0;
            for (let i = 0; i < num; i++) {
                sum += Math.floor(Math.random() * sides) + 1;
            }
            return sum;
        }

        function toggleAdvantage() {
            const advantage = document.getElementById("advantageOption").checked;
            document.getElementById("roll-selectors").style.display = advantage ? 'table-row' : 'none';
            document.getElementById("roll-values").style.display = advantage ? 'none' : 'table-row';
        }

        // Generar las tiradas de atributos
        function generateRolls() {
            // Generar 5 tiradas aleatorias entre 1 y 10
            rolls = Array.from({ length: 5 }, () => Math.floor(Math.random() * 10) + 1);
            const advantage = document.getElementById("advantageOption").checked;

            if (advantage) {
                alert("Tiradas generadas: " + rolls.join(", ") + ". Asigna cada tirada a una estadística.");
                showRollSelectors();
                document.getElementById("roll-values").style.display = 'none'; // Oculta la tercera fila si está usando ventaja
            } else {
                applyRollsDirectly();
                hideRollSelectors();
                
                // Muestra la tercera fila con valores aleatorios
                document.getElementById("roll-values").style.display = 'table-row';
                
                // Asigna los valores de tiradas aleatorias a cada celda de la fila
                document.getElementById("roll-strength").textContent = rolls[0];
                document.getElementById("roll-constitution").textContent = rolls[1];
                document.getElementById("roll-dexterity").textContent = rolls[2];
                document.getElementById("roll-wisdom").textContent = rolls[3];
                document.getElementById("roll-determination").textContent = rolls[4];
            }

            calculateVitality(document.getElementById("race").value);
            updatePreview();
        }

        function showRollSelectors() {
            document.querySelectorAll('.roll-select').forEach((select, index) => {
                select.style.display = 'inline';
                select.innerHTML = '<option value="">-- Seleccionar --</option>' + rolls.map(roll => `<option value="${roll}" class="available">${roll}</option>`).join('');
            });
        }

        function hideRollSelectors() {
            document.querySelectorAll('.roll-select').forEach(select => select.style.display = 'none');
        }

        function updateAdjustedStats() {
            let selectedValues = {};
            document.querySelectorAll('.roll-select').forEach(select => {
                const value = parseInt(select.value);
                if (!isNaN(value)) {
                    selectedValues[value] = (selectedValues[value] || 0) + 1;
                }
            });

            document.querySelectorAll('.roll-select').forEach(select => {
                const selectedValue = parseInt(select.value);
                select.querySelectorAll("option").forEach(option => {
                    const optionValue = parseInt(option.value);
                    option.className = (optionValue && selectedValues[optionValue] >= rolls.filter(r => r === optionValue).length && optionValue !== selectedValue) ? 'unavailable' : 'available';
                });
            });

            ["strength", "constitution", "dexterity", "wisdom", "determination"].forEach(stat => {
                const baseValue = raceStats[document.getElementById("race").value][stat];
                const selectedValue = parseInt(document.getElementById("select-" + stat).value) || 0;
                const extraValue = parseInt(document.getElementById("extra-" + stat).value) || 0;
                finalStats[stat] = baseValue + selectedValue + extraValue;
                document.getElementById("final-" + stat).textContent = `${baseValue} + ${selectedValue} + ${extraValue}: ${finalStats[stat]}`;
            });

            updatePreview();
        }

        function applyRollsDirectly() {
            ["strength", "constitution", "dexterity", "wisdom", "determination"].forEach((stat, i) => {
                const baseValue = raceStats[document.getElementById("race").value][stat];
                finalStats[stat] = baseValue + rolls[i];
                document.getElementById("final-" + stat).textContent = `${baseValue} + ${rolls[i]}: ${finalStats[stat]}`;
                document.getElementById("roll-" + stat).textContent = rolls[i];
            });
            updatePreview();
        }

        function updateExtraPoints() {
            let totalExtraPoints =
                parseInt(document.getElementById("extra-strength").value) +
                parseInt(document.getElementById("extra-constitution").value) +
                parseInt(document.getElementById("extra-dexterity").value) +
                parseInt(document.getElementById("extra-wisdom").value) +
                parseInt(document.getElementById("extra-determination").value);

            if (totalExtraPoints > 15) {
                alert("No puedes asignar más de 15 puntos en total.");
                return;
            }

            remainingPoints = 15 - totalExtraPoints;
            document.getElementById("remaining-points").textContent = "Distribuye " + remainingPoints + " puntos adicionales";

            const advantage = document.getElementById("advantageOption").checked;
            if (advantage) {
                ["strength", "constitution", "dexterity", "wisdom", "determination"].forEach(stat => {
                    const baseValue = raceStats[document.getElementById("race").value][stat];
                    const selectedValue = parseInt(document.getElementById("select-" + stat).textContent) || 0;
                    const extraValue = parseInt(document.getElementById("extra-" + stat).value) || 0;
                    finalStats[stat] = baseValue + selectedValue + extraValue;
                    document.getElementById("final-" + stat).textContent = `${baseValue} + ${selectedValue} + ${extraValue}: ${finalStats[stat]}`;
                });
            } else {
                ["strength", "constitution", "dexterity", "wisdom", "determination"].forEach(stat => {
                    const baseValue = raceStats[document.getElementById("race").value][stat];
                    const selectedValue = parseInt(document.getElementById("roll-" + stat).value) || 0;
                    const extraValue = parseInt(document.getElementById("extra-" + stat).value) || 0;
                    finalStats[stat] = baseValue + selectedValue + extraValue;
                    document.getElementById("final-" + stat).textContent = `${baseValue} + ${selectedValue} + ${extraValue}: ${finalStats[stat]}`;
                });
            }

            updatePreview();
        }


        function updatePreview() {
            document.getElementById("preview-race").textContent = document.getElementById("race").value;
            ["strength", "constitution", "dexterity", "wisdom", "determination", "vitality"].forEach(stat => {
                document.getElementById("preview-" + stat).textContent = finalStats[stat];
            });
        }

        // Cargar estadísticas base al inicio
        window.onload = loadBaseStats;
        // Mostrar los desplegables para asignar tiradas manualmente
function showRollSelectors() {
    const abbreviations = {
        strength: "FUE",
        constitution: "CON",
        dexterity: "DES",
        wisdom: "SAB",
        determination: "DET"
    };
    
    document.querySelectorAll('.roll-select').forEach((select, index) => {
        const stat = select.id.split('-')[1]; // Obtiene el nombre del atributo
        const abbreviation = abbreviations[stat]; // Obtiene la abreviatura correspondiente
        select.style.display = 'inline';
        select.innerHTML = `<option value="">${abbreviation}</option>` + 
            rolls.map(roll => `<option value="${roll}" class="available">${roll}</option>`).join('');
    });
}
// Calcular la vitalidad del personaje en función de la raza
function calculateVitality(race) {
            const vitalityStat = raceStats[race].vitality;
            const vitalityValue = rollDice(vitalityStat);
            finalStats["vitality"] = vitalityValue;
            document.getElementById("final-vitality").textContent = vitalityValue;
            document.getElementById("roll-vitality").textContent = vitalityValue;
        }
    </script>
</body>
</html>