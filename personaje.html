<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Personajes de Rol</title>
    <style>
        /* Diseño básico */
        body {
            display: flex;
            font-family: Arial, sans-serif;
            margin: 0;
            height: 100vh;
        }
        .container {
            display: flex;
            width: 100%;
        }
        .left-panel, .right-panel {
            padding: 20px;
            box-sizing: border-box;
        }
        .left-panel {
            width: 50%;
            background-color: #f4f4f4;
            border-right: 2px solid #ccc;
        }
        .right-panel {
            width: 50%;
            background-color: #ffffff;
        }
        h2 {
            margin-top: 0;
        }
        .stat {
            margin-bottom: 10px;
        }
        .character-preview {
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
        .roll-select option.available {
            color: green;
        }
        .roll-select option.unavailable {
            color: red;
        }
        table.stats-table {
            width: 100%;
            border-collapse: collapse;
        }
        table.stats-table th, table.stats-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Panel izquierdo: Opciones -->
        <div class="left-panel">
            <h2>Opciones del Personaje</h2>
            <div class="stat">
                <label for="race">Raza:</label>
                <select id="race" onchange="loadBaseStats()">
                    <option value="Enano">Enano</option>
                    <option value="Elfo">Elfo</option>
                    <option value="Mediano">Mediano</option>
                    <option value="Humano">Humano</option>
                    <option value="Semiogro">Semiogro</option>
                    <option value="Pato">Pato</option>
                </select>
            </div>

            

            <div class="stat">
                <label><input type="checkbox" id="advantageOption" onchange="toggleAdvantage()"> Opción ventajosa</label>
            </div>

            <button onclick="generateRolls()">Generar Tiradas</button>

            <!-- Atributos Base en Tabla -->
            <h3>Estadísticas Base</h3>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>FUE</th>
                        <th>CON</th>
                        <th>DES</th>
                        <th>SAB</th>
                        <th>DET</th>
                        <th>VIT</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="base-values">
                        <td id="base-strength">-</td>
                        <td id="base-constitution">-</td>
                        <td id="base-dexterity">-</td>
                        <td id="base-wisdom">-</td>
                        <td id="base-determination">-</td>
                        <td id="base-vitality">-</td>
                    </tr>
                    <tr id="roll-selectors" style="display: none;">
                        <td><select id="select-strength" class="roll-select" onchange="updateAdjustedStats()"></select></td>
                        <td><select id="select-constitution" class="roll-select" onchange="updateAdjustedStats()"></select></td>
                        <td><select id="select-dexterity" class="roll-select" onchange="updateAdjustedStats()"></select></td>
                        <td><select id="select-wisdom" class="roll-select" onchange="updateAdjustedStats()"></select></td>
                        <td><select id="select-determination" class="roll-select" onchange="updateAdjustedStats()"></select></td>
                        <td id="roll-vitality">-</td>
                    </tr>
                    <tr id="roll-values" style="display: none;">
                        <td id="roll-strength">-</td>
                        <td id="roll-constitution">-</td>
                        <td id="roll-dexterity">-</td>
                        <td id="roll-wisdom">-</td>
                        <td id="roll-determination">-</td>
                        <td id="roll-vitality-2">-</td>
                    </tr>
                    <tr>
                        <td colspan="6" id="remaining-points" style="text-align: center;"><strong>Distribuye 15 puntos adicionales</strong></td>
                    </tr>
                    <tr>
                        <td>  <input type="number" id="extra-strength" value="0" min="0" max="10" onchange="updateExtraPoints()"> </td>
                        <td>  <input type="number" id="extra-constitution" value="0" min="0" max="10" onchange="updateExtraPoints()"> </td>
                        <td>  <input type="number" id="extra-dexterity" value="0" min="0" max="10" onchange="updateExtraPoints()"> </td>
                        <td>  <input type="number" id="extra-wisdom" value="0" min="0" max="10" onchange="updateExtraPoints()"> </td>
                        <td>  <input type="number" id="extra-determination" value="0" min="0" max="10" onchange="updateExtraPoints()"> </td>
                        <td id="extra-vitality">-</td>
                    </tr>
                    <tr>
                        <td colspan="6" id="totallabel-points" style="text-align: center;"><strong>ESTADÍSTICAS TOTALES</strong></td>
                    </tr>
                    <tr>
                        <td><span id="final-strength">-</span></td>
                        <td><span id="final-constitution">-</span></td>
                        <td><span id="final-dexterity">-</span></td>
                        <td><span id="final-wisdom">-</span></td>
                        <td><span id="final-determination">-</span></td>
                        <td><span id="final-vitality">-</span></td>
                    </tr>
                </tbody>
            </table>
            <div class="stat">
                <label for="class">Clase:</label>
                <select id="classSelect" onchange="updateClassStats()">
                    <option value="Alquimista">Alquimista</option>
                    <option value="Bárbaro">Bárbaro</option>
                    <option value="Guerrero">Guerrero</option>
                    <option value="Ladrón">Ladrón</option>
                    <option value="Mago">Mago</option>
                    <option value="Montaraz">Montaraz</option>
                    <option value="Pícaro">Pícaro</option>
                    <option value="Sacerdote Guerrero">Sacerdote Guerrero</option>
                    <option value="Druida">Druida</option>
                    <option value="Caballero">Caballero</option>
                </select>
            </div>
        </div>

        <!-- Panel derecho: Vista previa -->
        <div class="right-panel">
            <h2>Vista Previa del Personaje</h2>
            <div class="character-preview" id="character-preview">
                <p><strong>Raza:</strong> <span id="preview-race">-</span></p>
                <table class="stats-table">
                    <thead>
                        
                        <tr>
                            <th>FUE</th>
                            <th>CON</th>
                            <th>DES</th>
                            <th>SAB</th>
                            <th>DET</th>
                            <th>VIT</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="base-values">
                            <td id="preview-strength">-</td>
                            <td id="preview-constitution">-</td>
                            <td id="preview-dexterity">-</td>
                            <td id="preview-wisdom">-</td>
                            <td id="preview-determination">-</td>
                            <td id="preview-vitality">-</td>
                        </tr>
                </tbody>
            </table>
              
                <p><strong>Clase:</strong> <span id="preview-class">-</span></p>
                <h3>Estadísticas de Combate</h3>
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>HC</th><th>HD</th><th>ESQ</th>
                            <th>FC</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td id="preview-HC">-</td><td id="preview-HD">-</td><td id="preview-ESQ">-</td>
                            <td id="preview-FC">-</td>
                        </tr>
                    </tbody>
                </table>
                <table class="stats-table">
                    <thead>
                        <tr><th>AA</th><th>TRU</th><th>CU</th><th>ALQ</th><th>PER</th><th>MANA</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td id="preview-AA">-</td><td id="preview-TRU">-</td><td id="preview-CU">-</td>
                            <td id="preview-ALQ">-</td><td id="preview-PER">-</td><td id="preview-MANA">-</td>
                        </tr>
                    </tbody>
                </table>
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>SUP</th><th>BD</th><th>AN</th><th>ENR</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td id="preview-SUP">-</td><td id="preview-BD">-</td><td id="preview-AN">-</td><td id="preview-ENR">1</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const raceStats = {
            "Enano": { strength: 40, constitution: 30, dexterity: 25, wisdom: 25, determination: 30, vitality: "1d6+6" },
            "Elfo": { strength: 25, constitution: 20, dexterity: 40, wisdom: 35, determination: 30, vitality: "1d6+8" },
            "Mediano": { strength: 20, constitution: 20, dexterity: 40, wisdom: 30, determination: 40, vitality: "1d6+5" },
            "Humano": { strength: 30, constitution: 30, dexterity: 30, wisdom: 30, determination: 30, vitality: "1d6+7" },
            "Semiogro": { strength: 50, constitution: 40, dexterity: 25, wisdom: 15, determination: 40, vitality: "2d6+10" },
            "Pato": { strength: 25, constitution: 25, dexterity: 30, wisdom: 30, determination: 40, vitality: "1d6+6" }
        };
        const classModifiers = {
    "Alquimista": { HC: -5, HD: -5, ESQ: -10, FC: -20, AA: "N/A", TRU: 0, CU: 5, ALQ: 10, PER: -10, MANA: "N/A", SUP: -20, BD: 0, AN: 0, ENR: 0 },
    "Barbaro": { HC: 15, HD: -10, ESQ: 5, FC: -20, AA: "N/A", TRU: -15, CU: -10, ALQ: -25, PER: -5, MANA: "N/A", SUP: -15, BD: 0, AN: 0, ENR: 0 },
    "Guerrero": { HC: 10, HD: 5, ESQ: 0, FC: -20, AA: "N/A", TRU: -15, CU: -10, ALQ: -25, PER: -10, MANA: "N/A", SUP: -15, BD: 0, AN: 0, ENR: 0 },
    "Ladrón": { HC: -5, HD: 5, ESQ: 5, FC: 10, AA: "N/A", TRU: 0, CU: -20, ALQ: -30, PER: 10, MANA: "N/A", SUP: -20, BD: 0, AN: 0, ENR: 0 },
    "Mago": { HC: -5, HD: -10, ESQ: -10, FC: -20, AA: 10, TRU: 5, CU: -5, ALQ: -20, PER: -10, MANA: 0, SUP: -20, BD: 0, AN: 0, ENR: 0 },
    "Montaraz": { HC: -5, HD: 15, ESQ: -5, FC: -25, AA: "N/A", TRU: -20, CU: -10, ALQ: -20, PER: 0, MANA: "N/A", SUP: 15, BD: 0, AN: 0, ENR: 0 },
    "Pícaro": { HC: 0, HD: 0, ESQ: 0, FC: 0, AA: "N/A", TRU: 5, CU: -10, ALQ: -25, PER: 0, MANA: "N/A", SUP: 0, BD: 0, AN: 0, ENR: 0 },
    "Sacerdote Guerrero": { HC: 5, HD: -5, ESQ: -5, FC: -20, AA: "N/A", TRU: -10, CU: 5, ALQ: -15, PER: -10, MANA: "N/A", SUP: -20, BD: 0, AN: 0, ENR: 1 },
    "Druida": { HC: -5, HD: 0, ESQ: -10, FC: -20, AA: 5, TRU: 0, CU: 5, ALQ: 0, PER: -5, MANA: 0, SUP: 0, BD: 0, AN: 0, ENR: 0 },
    "Caballero": { HC: 10, HD: 0, ESQ: 0, FC: -25, AA: "N/A", TRU: 5, CU: -15, ALQ: -20, PER: -10, MANA: "N/A", SUP: -25, BD: 0, AN: 0, ENR: 0 },
};
        let finalStats = {};
        let rolls = [];
        let remainingPoints = 15;

        function loadBaseStats() {
            const race = document.getElementById("race").value;
            const stats = raceStats[race];

            for (let [key, value] of Object.entries(stats)) {
                finalStats[key] = value;
                if (key === 'vitality') {
                    const vitalityRoll = rollDice(value);
                    document.getElementById("base-" + key).textContent = value;
                   // document.getElementById("roll-" + key).textContent = vitalityRoll;
                    finalStats[key] = vitalityRoll;
                } else {
                    document.getElementById("base-" + key).textContent = value;
                }
                document.getElementById("final-" + key).textContent = value;
            }

            updateCombatPreview();
            updatePreview();
        }

        function rollDice(dice) {
            const [num, sides, bonus] = dice.match(/\d+/g).map(Number);
            let sum = 0;
            for (let i = 0; i < num; i++) {
                sum += Math.floor(Math.random() * sides) + 1;
            }
            document.getElementById("roll-vitality").textContent = sum;
            document.getElementById("roll-vitality-2").textContent = sum;
            sum += bonus;
            return sum;
        }

        function toggleAdvantage() {
            const advantage = document.getElementById("advantageOption").checked;
            document.getElementById("roll-selectors").style.display = advantage ? 'table-row' : 'none';
            document.getElementById("roll-values").style.display = advantage ? 'none' : 'table-row';
        }

        function generateRolls() {
            rolls = Array.from({ length: 5 }, () => Math.floor(Math.random() * 10) + 1);
            const advantage = document.getElementById("advantageOption").checked;

            document.getElementById("extra-strength").value = 0;
            document.getElementById("extra-constitution").value = 0;
            document.getElementById("extra-dexterity").value = 0;
            document.getElementById("extra-wisdom").value = 0;
            document.getElementById("extra-determination").value = 0;
            document.getElementById("remaining-points").innerText = "Distribuye 15 puntos adicionales";

            if (advantage) {
                showRollSelectors();
                document.getElementById("roll-values").style.display = 'none';
            } else {
                applyRollsDirectly();
                hideRollSelectors();
                document.getElementById("roll-values").style.display = 'table-row';
                document.getElementById("roll-strength").textContent = rolls[0];
                document.getElementById("roll-constitution").textContent = rolls[1];
                document.getElementById("roll-dexterity").textContent = rolls[2];
                document.getElementById("roll-wisdom").textContent = rolls[3];
                document.getElementById("roll-determination").textContent = rolls[4];
            }

            calculateVitality(document.getElementById("race").value);
            updatePreview();
        }

        function showRollSelectors() {
            document.querySelectorAll('.roll-select').forEach((select, index) => {
                select.style.display = 'inline';
                select.innerHTML = '<option value="">-- Seleccionar --</option>' + rolls.map(roll => `<option value="${roll}" class="available">${roll}</option>`).join('');
            });
        }

        function hideRollSelectors() {
            document.querySelectorAll('.roll-select').forEach(select => select.style.display = 'none');
        }
// Calcular la vitalidad del personaje en función de la raza
function calculateVitality(race) {
            const vitalityStat = raceStats[race].vitality;
            const vitalityValue = rollDice(vitalityStat);
            finalStats["vitality"] = vitalityValue;
            document.getElementById("final-vitality").textContent = vitalityValue;
            document.getElementById("roll-vitality").textContent = vitalityValue;
        }
        function updateAdjustedStats() {
            let selectedValues = {};
            document.querySelectorAll('.roll-select').forEach(select => {
                const value = parseInt(select.value);
                if (!isNaN(value)) {
                    selectedValues[value] = (selectedValues[value] || 0) + 1;
                }
            });

            document.querySelectorAll('.roll-select').forEach(select => {
                const selectedValue = parseInt(select.value);
                select.querySelectorAll("option").forEach(option => {
                    const optionValue = parseInt(option.value);
                    option.className = (optionValue && selectedValues[optionValue] >= rolls.filter(r => r === optionValue).length && optionValue !== selectedValue) ? 'unavailable' : 'available';
                });
            });

            ["strength", "constitution", "dexterity", "wisdom", "determination"].forEach(stat => {
                const baseValue = raceStats[document.getElementById("race").value][stat];
                const selectedValue = parseInt(document.getElementById("select-" + stat).value) || 0;
                const extraValue = parseInt(document.getElementById("extra-" + stat).value) || 0;
                finalStats[stat] = baseValue + selectedValue + extraValue;
                document.getElementById("final-" + stat).textContent = `${finalStats[stat]}`;
            });

            updateCombatPreview();
            updatePreview();
        }

        function applyRollsDirectly() {
            ["strength", "constitution", "dexterity", "wisdom", "determination"].forEach((stat, i) => {
                const baseValue = raceStats[document.getElementById("race").value][stat];
                finalStats[stat] = baseValue + rolls[i];
                document.getElementById("final-" + stat).textContent = `${finalStats[stat]}`;
                document.getElementById("roll-" + stat).textContent = rolls[i];
            });
            updateCombatPreview();
            updatePreview();
        }

        function updateExtraPoints() {
    let totalExtraPoints = 0;

    // Recorremos todos los puntos extra y calculamos el total
    ["strength", "constitution", "dexterity", "wisdom", "determination"].forEach(stat => {
        const inputElement = document.getElementById("extra-" + stat);
        const value = parseInt(inputElement.value) || 0;
        totalExtraPoints += value;
    });

    // Si el total de puntos extra excede el límite, ajustamos los valores
    if (totalExtraPoints > 15) {
        //alert("No puedes asignar más de 15 puntos en total.");
        
        // Ajustamos cada campo para asegurar que el total no exceda 15 puntos
        let remainingPoints = 15;
        ["strength", "constitution", "dexterity", "wisdom", "determination"].forEach(stat => {
            const inputElement = document.getElementById("extra-" + stat);
            let value = parseInt(inputElement.value) || 0;
            
            if (value > remainingPoints) {
                value = remainingPoints;
            }
            inputElement.value = value;
            remainingPoints -= value;
        });

        totalExtraPoints = 15; // Ahora el total de puntos es 15
    }

    // Actualizamos el texto de puntos restantes
    remainingPoints = 15 - totalExtraPoints;
    document.getElementById("remaining-points").textContent = "Distribuye " + remainingPoints + " puntos adicionales";

    // Ajustamos los valores finales con los puntos extra
    const advantage = document.getElementById("advantageOption").checked;
    if (advantage) {
        ["strength", "constitution", "dexterity", "wisdom", "determination"].forEach(stat => {
            const baseValue = raceStats[document.getElementById("race").value][stat];
            const selectedValue = parseInt(document.getElementById("select-" + stat).value) || 0;
            const extraValue = parseInt(document.getElementById("extra-" + stat).value) || 0;
            finalStats[stat] = baseValue + selectedValue + extraValue;
            document.getElementById("final-" + stat).textContent = `${finalStats[stat]}`;
        });
    } else {
        ["strength", "constitution", "dexterity", "wisdom", "determination"].forEach(stat => {
            const baseValue = raceStats[document.getElementById("race").value][stat];
            const selectedValue = parseInt(document.getElementById("roll-" + stat).innerText) || 0;
            const extraValue = parseInt(document.getElementById("extra-" + stat).value) || 0;
            finalStats[stat] = baseValue + selectedValue + extraValue;
            document.getElementById("final-" + stat).textContent = `${finalStats[stat]}`;
        });
    }

    updateCombatPreview();
    updatePreview();
}

function updateCombatPreview() {
    // Obtener la clase seleccionada
    const selectedClass = document.getElementById("classSelect").value; // Asegúrate de que el ID sea correcto
    const modifiers = classModifiers[selectedClass] || {};

    const dexterity = (finalStats.dexterity || 0) + (modifiers.HC || 0);
    const wisdom = (finalStats.wisdom || 0) + (modifiers.AA !== "N/A" ? modifiers.AA : 0);
    const constitution = (finalStats.constitution || 0) + (modifiers.SUP || 0);
    const strength = (finalStats.strength || 0) + (modifiers.BD || 0);
    const determination = (finalStats.determination || 0) + (modifiers.FC || 0);

    // Aplicar valores modificados a los elementos de vista previa
    document.getElementById("preview-HC").textContent = dexterity + (modifiers.HC || 0);
    document.getElementById("preview-HD").textContent = dexterity + (modifiers.HD || 0);
    document.getElementById("preview-ESQ").textContent = dexterity + (modifiers.ESQ || 0);

    document.getElementById("preview-FC").textContent = determination;

    document.getElementById("preview-AA").textContent = modifiers.AA !== "N/A" ? wisdom : "N/A";
    document.getElementById("preview-TRU").textContent = wisdom + (modifiers.TRU || 0);
    document.getElementById("preview-CU").textContent = wisdom + (modifiers.CU || 0);
    document.getElementById("preview-ALQ").textContent = wisdom + (modifiers.ALQ || 0);
    document.getElementById("preview-PER").textContent = wisdom + (modifiers.PER || 0);
    document.getElementById("preview-MANA").textContent = modifiers.MANA !== "N/A" ? Math.floor(wisdom * 1.5) : "N/A";

    document.getElementById("preview-SUP").textContent = constitution >= 50 ? Math.floor((constitution - 50) / 5) + 1 : 0;
    document.getElementById("preview-AN").textContent = constitution >= 50 ? Math.floor((constitution - 50) / 5) + 1 : 0;

    document.getElementById("preview-BD").textContent = strength >= 50 ? Math.floor((strength - 50) / 10) + 1 : 0;
}

// Asumiendo que tienes un <select id="classSelect"> en tu HTML para la selección de clase.


        function updateClassStats() {
            const selectedClass = document.getElementById("classSelect").value;
            document.getElementById("preview-class").textContent = selectedClass;
        }

        function updatePreview() {
            document.getElementById("preview-race").textContent = document.getElementById("race").value;
            ["strength", "constitution", "dexterity", "wisdom", "determination", "vitality"].forEach(stat => {
                document.getElementById("preview-" + stat).textContent = finalStats[stat];
            });
        }

        window.onload = loadBaseStats;

           // Mostrar los desplegables para asignar tiradas manualmente
function showRollSelectors() {
    const abbreviations = {
        strength: "FUE",
        constitution: "CON",
        dexterity: "DES",
        wisdom: "SAB",
        determination: "DET"
    };
    
    document.querySelectorAll('.roll-select').forEach((select, index) => {
        const stat = select.id.split('-')[1]; // Obtiene el nombre del atributo
        const abbreviation = abbreviations[stat]; // Obtiene la abreviatura correspondiente
        select.style.display = 'inline';
        select.innerHTML = `<option value="">${abbreviation}</option>` + 
            rolls.map(roll => `<option value="${roll}" class="available">${roll}</option>`).join('');
    });
} 
    </script>
</body>
</html>
